# This is a basic workflow to upload files 
# from GitHub to server via GitHub Actions
name: Publish FTP Website on DEV

# Controls when the workflow will run
on:

  # Triggers the workflow on push request event 
  # but only for the specific branch
  push:
    branches: [ master ]

# A workflow run is made up of one or more jobs 
# that can run sequentially or in parallel
jobs:

  # This workflow contains a single job called "SFTP-Deploy-Action"
  SFTP-Deploy-Action:
    name: SFTP-Deploy-Action

    # The type of runner that the job will run on 
    # (depends on server but usually this value is works)
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks 
    # that will be executed as part of the job
    steps:
     - name: Checkout
       uses: actions/checkout@v2.3.4
      
     - name: Setup .NET
       uses: actions/setup-dotnet@v3
       with:
        dotnet-version: '8.0.x'
      
     - name: Build solution
       run: dotnet build -c Release --verbosity minimal
      
     - name: Run tests
       run: dotnet test -c Release --verbosity minimal --no-build --no-restore
      
     - name: Publish
       run: dotnet publish -c Release --no-build --no-restore
          
      # for deploying repository content to remote server
     - name: SFTP-Deploy-Action
       uses: milanmk/actions-file-deployer@master
       with:
          remote-protocol: sftp

          remote-host: ${{ secrets.FTP_HOST }}
          remote-user: ${{ secrets.FTP_USER }}
          remote-password: ${{ secrets.FTP_PASSWORD }}

          local-path: /home/runner/work/CoreGithub/CoreGithub/CoreGithub/bin/Release/net8.0/publish/
          remote-path: /

          remote-port: 22
