var jsonTemplate1 = '{"Display":{"Position":"Center","Animation":"0","BgColor":"#e5e5e5","BgImage":"","Padding":"10,10,10,10","Border":"#b86969","BorderWidth":"5","BorderRadius":"5","Height":"0","Interval":"0","ScreenName":"","Close":"1"},"Fields":[{"Type":"Img","Text":"","ImageUrl":"/Content/images/inApp-ban.jpg","Name":"TopBanner","Category":"","Score":"1","Size":"0","Color":"","BgColor":"","Style":"","Border":"","BorderWidth":"0","BorderRadius":"0","Mandatory":"0","Width":"100","Margin":"0,0,0,0","Padding":"0,0,0,0","Align":"Left","Orientation":"Center","Group":"1","Action":"","Message":"","Redirect":"","Parameter":"","CloseDialog":"0"},{"Type":"Tv","Text":"Buy one get one offer starting from today. Get your goodie now !","ImageUrl":"","Name":"Field-1","Category":"None","Score":"1","Size":"14","Color":"#4e61a3","BgColor":"","Style":"Bold","Border":"#ffffff","BorderWidth":"0","BorderRadius":"0","Mandatory":"0","Width":"100","Margin":"10,10,10,10","Padding":"0,0,0,0","Align":"","Orientation":"Center","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"0"},{"Type":"Btn","Text":"BUY NOW","ImageUrl":"","Name":"Buy","Category":"","Score":"5","Size":"15","Color":"#ffffff","BgColor":"#5c225a","Style":"Normal","Border":"#767676","BorderWidth":"0","BorderRadius":"1","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"0,10,0,10","Align":"Left","Orientation":"Center","Group":"1","Action":"","Message":"Thanks!","Redirect":"","Parameter":"","CloseDialog":"1"}]}';
var jsonTemplate2 = '{"Display":{"Position":"Top","Animation":"0","BgColor":"#ffffff","BgImage":"","Padding":"10,10,10,10","Border":"#ffffff","BorderWidth":"0","BorderRadius":"0","Height":"0","Interval":"0","ScreenName":"","Close":"1"},"Fields":[{"Type":"Img","Text":"","ImageUrl":"/Content/images/template_3.png","Name":"Big-Banner","Category":"","Score":"1","Size":"0","Color":"#ffffff","BgColor":"#ffffff","Style":"","Border":"#ffffff","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"0,0,0,0","Align":"Top","Orientation":"Center","Group":"1","Action":"","Message":"","Redirect":"","Parameter":"","CloseDialog":"0"}]}';
var jsonTemplate3 = '{"Display":{"Animation":"0","BgColor":"#ffffff","BgImage":"","Border":"#db2727","BorderRadius":"5","BorderWidth":"5","Close":"1","Height":"1","Interval":"0","Padding":"10,10,10,10","Position":"Center","ScreenName":""},"Fields":[{"Type":"Tv","Text":"Welcome Back !","ImageUrl":"","Name":"Field-1","Category":"None","Score":"1","Size":"18","Color":"#767676","BgColor":"#ffffff","Style":"Bold","Border":"#000000","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"10,10,10,10","Padding":"0,0,0,0","Align":"","Orientation":"Center","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"0"},{"Type":"Img","Text":"","ImageUrl":"/Content/images/inapp-ban-btn2.jpg","Name":"Banner","Category":"","Score":"5","Size":"30","Color":"#767676","BgColor":"#ffffff","Style":"Bold","Border":"","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"0,0,0,0","Align":"Center","Orientation":"Center","Group":"1","Action":"","Message":"","Redirect":"","Parameter":"","CloseDialog":"0"},{"Type":"Btn","Text":"LearnMore","ImageUrl":"","Name":"Learn-More","Category":"","Score":"5","Size":"15","Color":"#ffffff","BgColor":"#db2727","Style":"Bold","Border":"","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"0,5,0,5","Align":"Left","Orientation":"Center","Group":"2","Action":"Browser","Message":"Thanks!","Redirect":"https://www.plumb5.com","Parameter":"","CloseDialog":"0"}]}';
var jsonTemplate4 = '{"Display":{"Position":"Top","Animation":"0","BgColor":"#ffffff","BgImage":"/Content/images/template_6.png","Padding":"0,0,0,0","Border":"#ffffff","BorderWidth":"5","BorderRadius":"0","Height":"0","Interval":"0","ScreenName":"","Close":"1"},"Fields":[{"Type":"Tv","Text":"50% OFF ON NEXT FLIGHT BOOKING!","ImageUrl":"","Name":"Heading","Category":"None","Score":"5","Size":"14","Color":"#ffffff","BgColor":"","Style":"Bold","Border":"","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"0,100,0,0","Padding":"0,0,0,300,0","Align":"Left","Orientation":"Center","Group":"1","Action":"","Message":"","Redirect":"","Parameter":"","CloseDialog":"0"},{"Type":"Btn","Text":"FLY OFF NOW","ImageUrl":"","Name":"","Category":"None","Score":"5","Size":"15","Color":"#ffffff","BgColor":"#87421A","Style":"Bold_Italic","Border":"#767676","BorderWidth":"0","BorderRadius":"1","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"0,10,0,10","Align":"Bottom","Orientation":"Center","Group":"1","Action":"","Message":"Thanks!","Redirect":"","Parameter":"","CloseDialog":"1"}]}';
var jsonTemplate5 = '{"Display":{"Position":"Center","Animation":"0","BgColor":"#ffffff","BgImage":"","Padding":"3,3,3,3","Border":"#db2727","BorderWidth":"5","BorderRadius":"10","Height":"0","Interval":"0","ScreenName":"","Close":"1"},"Fields":[{"Type":"Tv","Text":"How much you enjoyed our ride ?","ImageUrl":"","Name":"Question","Category":"None","Score":"5","Size":"14","Color":"#767676","BgColor":"#cccccc","Style":"Bold","Border":"","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"0,20,0,20","Align":"Center","Orientation":"Center","Group":"1","Action":"","Message":"","Redirect":"","Parameter":"","CloseDialog":"0"},{"Type":"Rb","Text":"5","ImageUrl":"","Name":"Rating","Category":"None","Score":"5","Size":"20","Color":"#20d632","BgColor":"#ffffff","Style":"Bold","Border":"","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"0,20,0,20","Align":"Center","Orientation":"Center","Group":"1","Action":"","Message":"","Redirect":"","Parameter":"","CloseDialog":"0"},{"Type":"Btn","Text":"SUBMIT","Name":"button","Category":"None","Score":"5","Size":"15","Color":"#ffffff","BgColor":"#994040","Style":"Bold","Border":"","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"0,5,0,5","Align":"Center","Orientation":"Center","Group":"1","Action":"Form","Message":"Thanks!","Redirect":"","Parameter":"","CloseDialog":"0"}]}';
var jsonTemplate6 = '{"Display":{"Position":"Center","Animation":"0","BgColor":"#e5e5e5","BgImage":"","Padding":"10,10,10,10","Border":"#b86969","BorderWidth":"5","BorderRadius":"5","Height":"1","Interval":"0","ScreenName":"","Close":"1"},"Fields":[{"Type":"Tv","Text":"Happy to help you","ImageUrl":"","Name":"Field-1","Category":"None","Score":"1","Size":"16","Color":"#521D32","BgColor":"#cccccc","Style":"Bold_Italic","Border":"#FFFFFF","BorderWidth":"0","BorderRadius":"0","Mandatory":"0","Width":"100","Margin":"5,5,5,5","Padding":"0,8,0,10","Align":"","Orientation":"Center","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"1"},{"Type":"Et","Text":"Name","ImageUrl":"","Name":"Name","Category":"Name","Score":"1","Size":"15","Color":"#495057","BgColor":"#ffffff","Style":"Normal","Border":"#BDBDBD","BorderWidth":"1","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"5,5,5,5","Padding":"5,5,5,5","Align":"","Orientation":"Left","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"1"},{"Type":"Et","Text":"EmailId","ImageUrl":"","Name":"EmailId","Category":"Emailid","Score":"1","Size":"15","Color":"#495057","BgColor":"#ffffff","Style":"Normal","Border":"#BDBDBD","BorderWidth":"1","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"5,5,5,5","Padding":"5,5,5,5","Align":"","Orientation":"Left","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"1"},{"Type":"Et","Text":"Phone","ImageUrl":"","Name":"Phone","Category":"Phone","Score":"1","Size":"15","Color":"#495057","BgColor":"#ffffff","Style":"Normal","Border":"#BDBDBD","BorderWidth":"1","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"5,5,5,5","Padding":"5,5,5,5","Align":"","Orientation":"Left","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"1"},{"Type":"Sp","Text":"Bangalore,Kolkata,Delhi","ImageUrl":"","Name":"City","Category":"Location","Score":"0","Size":"15","Color":"#495057","BgColor":"#ffffff","Style":"Normal","Border":"#767676","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"5,5,5,5","Padding":"5,5,5,5","Align":"","Orientation":"Left","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"1"},{"Type":"Rg","Text":"Male,Female","ImageUrl":"","Name":"Gender","Category":"Gender","Score":"1","Size":"13","Color":"#322F36","BgColor":"","Style":"Normal","Border":"#FFFFFF","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"5,5,5,5","Align":"","Orientation":"Left","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"1"},{"Type":"Cb","Text":"Readytobuy","ImageUrl":"","Name":"Buy","Category":"MM","Score":"0","Size":"13","Color":"#322F36","BgColor":"","Style":"Normal","Border":"#767676","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"0,0,0,0","Padding":"0,0,0,0","Align":"","Orientation":"Left","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"1"},{"Type":"Btn","Text":"BuyNow","ImageUrl":"","Name":"Field-1","Category":"None","Score":"0","Size":"13","Color":"#ffffff","BgColor":"#5C225A","Style":"Normal","Border":"#767676","BorderWidth":"0","BorderRadius":"0","Mandatory":"1","Width":"100","Margin":"5,5,5,5","Padding":"0,10,0,10","Align":"","Orientation":"Center","Group":"1","Action":"0","Message":"","Redirect":"","IosRedirect":"","Parameter":"","CloseDialog":"1"}]}';

var urlregex = new RegExp("^(http:\/\/|https:\/\/){1}([0-9A-Za-z]+\.)");

var getFinalJson = "";
var container = "";
var finalField = "";

var screenType = "";
var inappfieldnum = 0;
var getInAppPrevclsscss, getinAppParentIdbrush;
var selectedFieldId = -1, preselectedFieldId = -1, selectedFieldType = "";
var bgImage = "";
var fieldImage = "";
var DraftTemplateId = 0;
var InAppCampaignType = "";
var inappStyleEditCss = "";

$(document).ready(function () {
    HidePageLoading();
    GetScreenList();
    GetContactProperties('ddlFieldCategory');
    if (urlParam("Id") == 0)
        SelectTemplate("Banner & Text & Button", "");
});


$(".inappviewtemplay").click(function () {

    let getinapptempnameval = $(this).attr("data-inapptemp");
    SelectTemplate(getinapptempnameval, "");
});

function SelectTemplate(temptype, jsonTemplate) {
    HidePageLoading();

    let getinapptempnameval = temptype;
    screenType = getinapptempnameval;
    $("#inapppoptemname").val(getinapptempnameval);
    $("#inappviewtempmod").modal("hide");
    $(".inAppbantxtimgwrp").remove();
    InAppCampaignType = getinapptempnameval;

    if (jsonTemplate != "") {
        getFinalJson = jsonTemplate;
    }
    else {
        if (getinapptempnameval == "Banner & Text & Button") {
            DraftTemplateId = 1;
            getFinalJson = jsonTemplate1;
        } else if (getinapptempnameval == "Full Screen Banner") {
            DraftTemplateId = 2;
            getFinalJson = jsonTemplate2;
        } else if (getinapptempnameval == "Title & Banner & Button") {
            DraftTemplateId = 3;
            getFinalJson = jsonTemplate3;
        } else if (getinapptempnameval == "Full Screen Banner & Button") {
            DraftTemplateId = 4;
            getFinalJson = jsonTemplate4;
        } else if (getinapptempnameval == "InApp Rattings") {
            DraftTemplateId = 5;
            getFinalJson = jsonTemplate5;
        } else if (getinapptempnameval == "Capture Form") {
            DraftTemplateId = 6;
            getFinalJson = jsonTemplate6;
        }
    }

    var obj = JSON.parse(getFinalJson);
    container = obj.Display;
    finalField = obj.Fields;

    BindContainerStyle();
    BindPreView();
}

function BindPreView() {

    inappfieldnum = finalField.length;
    //main container.........................
    var mainStyle = "";
    if (container.BgColor != "")
        mainStyle += "background-color:" + container.BgColor + ";";
    if (container.Border != "")
        mainStyle += "border:" + container.BorderWidth + "px solid " + container.Border + ";";
    if (container.BorderRadius != "")
        mainStyle += "border-radius:" + container.BorderRadius + "px;";
    if (container.BgImage != "")
        mainStyle += "background-image:url(" + container.BgImage + ");";
    if (container.Padding != "") {
        var getPadding = container.Padding.split(/,/);
        var setPadding = getPadding[1] + "px " + getPadding[2] + "px " + getPadding[3] + "px " + getPadding[0] + "px";
        mainStyle += "padding:" + setPadding + ";";
    }
    $(".inAppmaincontainer").attr("style", mainStyle);


    //field.................................
    let addbantxtbtncont = '<div class="inAppbantxtimgwrp">';
    for (var fieldNo = 0; fieldNo < finalField.length; fieldNo++) {

        var fieldStyle = "";
        if (finalField[fieldNo].Color != "")
            fieldStyle += "color:" + finalField[fieldNo].Color + ";";
        if (finalField[fieldNo].Size != "")
            fieldStyle += "font-size:" + finalField[fieldNo].Size + "px;";
        if (finalField[fieldNo].Style != "")
            fieldStyle += "font-weight:" + finalField[fieldNo].Style + ";";
        if (finalField[fieldNo].Orientation != "")
            fieldStyle += "text-align:" + finalField[fieldNo].Orientation + ";";
        if (finalField[fieldNo].Border != "")
            fieldStyle += "border:" + finalField[fieldNo].BorderWidth + "px solid " + finalField[fieldNo].Border + ";";
        if (finalField[fieldNo].BorderRadius != "")
            fieldStyle += "border-radius:" + finalField[fieldNo].BorderRadius + "px;";
        if (finalField[fieldNo].Padding != "") {
            var getPadding = finalField[fieldNo].Padding.split(/,/);
            var setPadding = getPadding[1] + "px " + getPadding[2] + "px " + getPadding[3] + "px " + getPadding[0] + "px";
            fieldStyle += "padding:" + setPadding + ";";
        }
        if (finalField[fieldNo].Margin != "") {
            var getMargin = finalField[fieldNo].Margin.split(/,/);
            var setMargin = getMargin[0] + "px " + getMargin[0] + "px " + getMargin[0] + "px " + getMargin[0] + "px";
            fieldStyle += "margin:" + setMargin + ";";
        }
        if (finalField[fieldNo].BgColor != "")
            fieldStyle += "background-color:" + finalField[fieldNo].BgColor + ";";

        var Type = finalField[fieldNo].Type;

        if (Type == "Img") {

            var imgurl = finalField[fieldNo].ImageUrl != "" ? "background-image: url(" + finalField[fieldNo].ImageUrl + ")" : "";
            if (screenType == "Full Screen Banner") {
                addbantxtbtncont += `<div id="inappcustfield` + fieldNo + `" class="inappparatext inAppfullbgwrp">
            <div style= "` + imgurl + `" data-inputtype="Img" class ="inAppfullscreen"><a href="javascript:void(0)" target="_blank"></a>
            </div>
            </div>`;
            }
            else {
                addbantxtbtncont += `<div id="inappcustfield` + fieldNo + `" class="inappparatext">
            <div style= "` + imgurl + `" data-inputtype="Img"
            class="inAppbanwrp custbgban"></div>
            </div>`;
            }
        }
        else if (Type == "Tv") {
            addbantxtbtncont += `<div id="inappcustfield` + fieldNo + `" class="inappparatext">
            <p data-inputtype="Tv"
            class ="inAppbantitle" style= "` + fieldStyle + `" > ` + finalField[fieldNo].Text + `
            </p>
            </div>`;
        }
        else if (Type == "Btn") {
            addbantxtbtncont += `<div id="inappcustfield` + fieldNo + `" class="inappaddbtnswrp">
            <a style= "` + fieldStyle + `" data-inputtype="Btn"
            id="inappbtnName1" href="javascript:void(0)"
            class="btn btn-danger btn-block"
            target="_blank">
           `+ finalField[fieldNo].Text + `
            </a>
            </div>`;
        }

        else if (Type == "Et") {
            addbantxtbtncont += `<div id="inappcustfield` + fieldNo + `" class="inappparatext">
            <input style= "` + fieldStyle + `" data-inputtype="Et" type="text" placeholder= "` + finalField[fieldNo].Name + `" name="" class ="form-control form-control-sm inappfrmtxtbx" id="">
            </div>`;
        }
        else if (Type == "Sp") {
            var intext = finalField[fieldNo].Text.split(/,/); var option = "";
            for (i = 0; i < intext.length; i++) {
                option += "<option value=" + intext[i] + ">" + intext[i] + "</option>";
            }

            addbantxtbtncont += `<div id="inappcustfield` + fieldNo + `" class="inappparatext">
            <select  data-inputtype="Sp" style= "` + fieldStyle + `" class ="form-control form-control-sm inappfrmtxtbx" id=""> ` + option + ` </select>
            </div>`;
        }
        else if (Type == "Rg") {
            var intext = finalField[fieldNo].Text.split(/,/); var option = "";
            for (i = 0; i < intext.length; i++) {
                option += `<div data-inputtype="Rg" class="custom-control custom-radio"><input type="radio" value="" id="" name="` + intext[i] + `" class="custom-control-input">
                    <label style= "` + fieldStyle + `" class ="custom-control-label" for= "` + intext[i] + `" > ` + intext[i] + ` </label></div>`;
            }
            addbantxtbtncont += `<div id="inappcustfield` + fieldNo + `" class="inappparatext">
            `+ option + `
            </div>`;
        }
        else if (Type == "Cb") {
            addbantxtbtncont += `<div id="inappcustfield` + fieldNo + `" class="inappparatext custom-control custom-checkbox">
            <input data-inputtype="Cb" type="checkbox" value= "`+ finalField[fieldNo].Text + `" class ="custom-control-input" name= "` + finalField[fieldNo].Text + `" id="">
            <label style= "` + fieldStyle + `"  data-inputtype="Cb"class ="custom-control-label" for= "` + finalField[fieldNo].Text + `" > ` + finalField[fieldNo].Text + ` </label>
            </div>`;
        }
        else if (Type == "Rat") {
            var img = '';
            for (i = 0; i < parseInt(finalField[fieldNo].Text); i++) {
                img += '<span class="fa fa-star-o"></span>';
            }

            addbantxtbtncont += `<div id="inappcustfield` + fieldNo + `" class="inappparatext">
            <div style= "` + fieldStyle + `" data-inputtype="Rb" class ="inappstarratitemwrp">
            `+ img + `
            </div>
            </div>`;
        }

        if (screenType == "Full Screen Banner & Button") {

        }

    }

    addbantxtbtncont += '<div';
    $(".inAppmaincontainer").html(addbantxtbtncont);

    inappmousentleave();
    inappaddbtnhvrleve();
}

function BindContainerStyle() {
    var obj = JSON.parse(getFinalJson);
    container = obj.Display;

    if (container != null) {
        //main container.........................
        //if (container.BgImage != "")
        //    mainStyle += "background-image:url(" + container.BgImage + ");";

        if (container.BgColor != "") {
            $("#inappmainbgcol").val(container.BgColor);
            $("#inappmainbgcol").next().css("background-color", container.BgColor);
        }
        if (container.Border != "") {
            $("#inappmainbgbrdcol").val(container.Border);
            $("#inappmainbgbrdcol").next().css("background-color", container.Border);
        }
        if (container.BorderWidth != "")
            $("#inappmainbgbrdwid").val(container.BorderWidth);
        if (container.BorderRadius != "")
            $("#inappmainbgbrdradi").val(container.BorderWidth);
        if (container.Position != "")
            $("#inappmainpos").val(container.Position);
        if (container.Animation != "")
            $("#inappanimatban").val(container.Animation);
        if (container.Interval != "")
            $("#inappmaininterval").val(container.Interval);
        if (container.Close != "")
            $("#inappmainclose").val(container.Close);

        if (container.Padding != "") {
            var getPadding = container.Padding.split(/,/);
            $("#inappbodypaddTop").val(getPadding[1]); $("#inappbodypaddRight").val(getPadding[2]); $("#inappbodypaddbttm").val(getPadding[3]); $("#inappbodypaddLeft").val(getPadding[0]);
        }
    }
}

function BindFieldStyle() {
    var fieldNo = selectedFieldId;
    if (finalField[fieldNo] != null) {
        if (finalField[fieldNo].Color != "") {
            $("#inapptextcol").val(finalField[fieldNo].Color);
            $("#inapptextcol").next().css("background-color", finalField[fieldNo].Color);
        }
        if (finalField[fieldNo].Size != "")
            $("#inapptextsize").val(finalField[fieldNo].Size);
        if (finalField[fieldNo].Style != "")
            $("#inapptextbold").val(finalField[fieldNo].Style);
        if (finalField[fieldNo].Orientation != "")
            $("#inapptextalign").val(finalField[fieldNo].Orientation);
        if (finalField[fieldNo].Border != "") {
            $("#inapptextbrdcol").val(finalField[fieldNo].Border);
            $("#inapptextbrdcol").next().css("background-color", finalField[fieldNo].Border);
        }
        if (finalField[fieldNo].BorderWidth != "")
            $("#inapptextbrdwid").val(finalField[fieldNo].BorderWidth);
        if (finalField[fieldNo].BorderRadius != "")
            $("#inapptextbrdradi").val(finalField[fieldNo].BorderRadius);
        if (finalField[fieldNo].BgColor != "") {
            $("#inapptextbgcol").val(finalField[fieldNo].BgColor);
            $("#inapptextbgcol").next().css("background-color", finalField[fieldNo].BgColor);
        }
        if (finalField[fieldNo].Margin != "") {
            var getMargin = finalField[fieldNo].Margin.split(/,/);
            $("#inapptextmarg").val(getMargin[0]);
        }
        if (finalField[fieldNo].Padding != "") {
            var getPadding = finalField[fieldNo].Padding.split(/,/);
            $("#inapptxtpaddtop").val(getPadding[1]); $("#inapptxtpaddright").val(getPadding[2]); $("#inapptxtpaddbttm").val(getPadding[3]); $("#inapptxtpaddleft").val(getPadding[0]);
        }

        //Action
        $(".naviscreenbtn2, .deeplinkingfildbtn2, .mobnotifvalpairbtn2, .brwserurlbtn2").addClass("hideDiv");
        $(".mobvalpairmorebtn2").html("");

        if (finalField[fieldNo].Action != "") {
            $("#mobdefclickactbtn2").val(finalField[fieldNo].Action);
        }

        if (finalField[fieldNo].Action == "Screen") {
            $(".naviscreenbtn2, .mobnotifvalpairbtn2").removeClass("hideDiv");
            $("#ui_ddlScreen").val(finalField[fieldNo].Redirect);

            if (finalField[fieldNo].Parameter != "") {
                setKeyPairValue('', finalField[fieldNo].Parameter);
            }

            if (finalField[fieldNo].IosRedirect != "") {
                $("#ui_ddlScreenIos").val(finalField[fieldNo].IosRedirect);
            }
        }
        if (finalField[fieldNo].Action == "Deeplink") {
            $(".deeplinkingfildbtn2, .mobnotifvalpairbtn2").removeClass("hideDiv");
            $("#txtDeeplink").val(finalField[fieldNo].Redirect);

            if (finalField[fieldNo].Parameter != "") {
                setKeyPairValue('', finalField[fieldNo].Parameter);
            }
        }
        if (finalField[fieldNo].Action == "" || finalField[fieldNo].Action == "Cancel" || finalField[fieldNo].Action == "0") {
            $("#ui_ddlScreen").val("select");
            $("#ui_ddlScreenIos").val("select");
            $("#txtBrowser").val("");
            $("#txtDeeplink").val("");
            $("#txtActionMsg").val("");
            $(".txtparameter").val("");
            $(".mobvalpairmorebtn2").html("");
            $("#mobdefclickactbtn2").val("0");

        }
        if (finalField[fieldNo].Action == "Browser") {
            $(".brwserurlbtn2").removeClass("hideDiv");
            $("#txtBrowser").val(finalField[fieldNo].Redirect);
        }


        if (finalField[fieldNo].CloseDialog == "1") {
            $("#inappclsedialogYes").prop("checked", true);
        }
        if (finalField[fieldNo].CloseDialog == "0") {
            $("#inappclsedialogNo").prop("checked", true);
        }
        if (finalField[fieldNo].Message != "") {
            $("#txtActionMsg").val(finalField[fieldNo].Message);
        }
    }
}



//p5-add-field-link
$(".inappaddfildbtn").click(function () {
    $(".addinappEditwid").addClass("hideDiv");
    $(".addinappcuswid").removeClass("hideDiv");
    $("#inappaddfieldtype").val("select");
    $("#inappaddtextcont, #inappadddrpdwnlist").val("");
    $(".inapptextcontwrp, .inappformwidwrp").addClass(
        "hideDiv"
    );
    //$(
    //  "#inapptextpaddall, #inapptxtpaddtop, #inapptxtpaddright, #inapptxtpaddbttm, #inapptxtpaddleft, #inappinptlblname, #inappaddchckbxlist"
    //).val("");
    $("#inapptextsize").val("13");
    $("#inapptextcol").val("#495057");
    $(".inappbgcolicon").css("background-color", "#ffffff");
    $("#inapptextalign").val("Left");
    $("#inapptextbold").val("Normal");
    $("#inapptextallpadd").prop("checked", true);
    $("#inapptxtpaddtop, #inapptxtpaddright, #inapptxtpaddbttm, #inapptxtpaddleft,#inapptextbrdradi,#inapptextmarg,#inapptextbrdwid"
    ).val("0");
    $(".popupcontainer, .inappallpaddwrp").removeClass("hideDiv");

    selectedFieldId = -1;
    selectedFieldType = "";
    fieldImage = "";

    $(".naviscreenbtn2, .deeplinkingfildbtn2, .mobnotifvalpairbtn2, .brwserurlbtn2").addClass("hideDiv");
    $("#ui_ddlScreen").val("select");
    $("#ui_ddlScreenIos").val("select");
    $("#txtBrowser").val("");
    $("#txtDeeplink").val("");
    $("#txtActionMsg").val("");
    $(".txtparameter").val("");
    $(".mobvalpairmorebtn2").html("");
    $("#mobdefclickactbtn2").val("0");
});


//p5-onchage of ddl type
$(".popupcontainer").on("change", "#inappaddfieldtype", function () {
    $("#inappaddtextcont").val("");
    $("#inappinptlblname").val("");
    $("#inappinptvalue").val("");
    $("#ddlMandatory").val(1);
    $("#txtScore").val(0);
    $("#ddlFieldCategory").val("None");
    $("#ddlHorizontalAlign").val(1);

    selectedFieldType = $("#inappaddfieldtype option:selected").val();

    $("#inapptextcolsty").css("background-color", "rgb(73, 80, 87)");

    if (selectedFieldType == "Img") {
        $(
            ".inapptextcontwrp, .inappformwidwrp, .inappbantextwrp, .inappbantitlewrp, .inappinputwrp, .inappchckradiowrp, .inapprattingwrp, .inappbanbtnwrp"
        ).addClass("hideDiv");
        $(".inappbgbannerwrp, .inappactionwrp").removeClass("hideDiv");
        inappaddimgban = `<div id="inappcustfield${inappfieldnum}" class="inappparatext">
    <div data-inputtype="image" class="inAppbanwrp custbgban"></div></div>`;
    }
    else if (selectedFieldType == "Et" || selectedFieldType == "Sp" || selectedFieldType == "Cb" || selectedFieldType == "Rg") {
        if (selectedFieldType != "Et") { $("#spnTips").removeClass("hideDiv"); } else { $("#spnTips").addClass("hideDiv"); }

        $(
            ".inapptextcontwrp, .inappbgbannerwrp, .inappbantextwrp, .inappbantitlewrp, .inappdrpdwnedit, .inappchckbxedit, .inappchckradiowrp, .inapprattingwrp, .inappbanbtnwrp"
        ).addClass("hideDiv");
        $(".inappinputwrp, .inappformwidwrp, .inappactionwrp").removeClass(
            "hideDiv"
        );
        inappaddinput = `<div id="inappcustfield${inappfieldnum}" class="inappparatext">
           <input data-inputtype="text" type="text" placeholder="Name" name=""
               class="form-control form-control-sm inappfrmtxtbx" id="">
       </div>`;
    }
    else {
        $("#spnTips").addClass("hideDiv");
        $(".inappbantextwrp, .inapptextcontwrp, .inappactionwrp").removeClass(
            "hideDiv"
        );
        $(
            ".inappbgbannerwrp, .inappinputwrp, .inappformwidwrp, .inappdrpdwnedit, .inappchckbxedit, .inappchckradiowrp, .inapprattingwrp, .inappbanbtnwrp"
        ).addClass("hideDiv");
        inappaddtext = `<div id="inappcustfield${inappfieldnum}" class="inappparatext">
      <p data-inputtype="inapptitltext" class="inappcusttext">Buy one get one offer starting from today. Get your goodie now!
      </p>
  </div>`;
    }
});


//p5-add manage icons
inappmousentleave = () => {
    $(".inappparatext")
        .mouseenter(function () {
            $(".insppeditdel").remove();
            $(this).append(
                '<div class="insppeditdel"><i class="fa fa-paint-brush mr-2"></i><i class="fa fa-pencil mr-2"></i><i class="fa fa-trash"></i></div>'
            );
        })
        .mouseleave(function () {
            $(".insppeditdel").remove();
        });
};

$(".inappparatext")
    .mouseenter(function () {
        $(".insppeditdel").remove();
        $(this).append(
            '<div class="insppeditdel"><i class="fa fa-paint-brush mr-2"></i><i class="fa fa-pencil mr-2"></i><i class="fa fa-trash"></i></div>'
        );
    })
    .mouseleave(function () {
        $(".insppeditdel").remove();
    });

inappaddbtnhvrleve = () => {
    $(".inappaddbtnswrp")
        .mouseenter(function () {
            $(".insppeditdel").remove();
            $(this).append(
                '<div class="insppeditdel"><i class="fa fa-paint-brush mr-2"></i><i class="fa fa-pencil mr-2"></i><i class="fa fa-trash"></i></div>'
            );
        })
        .mouseleave(function () {
            $(".insppeditdel").remove();
        });
};

$(".inappaddbtnswrp")
    .mouseenter(function () {
        $(".insppeditdel").remove();
        $(this).append(
            '<div class="insppeditdel"><i class="fa fa-paint-brush mr-2"></i><i class="fa fa-pencil mr-2"></i><i class="fa fa-trash"></i></div>'
        );
    })
    .mouseleave(function () {
        $(".insppeditdel").remove();
    });

/*Add content on Submit field*/ //p5-add

$(".popupcontainer").on("click", ".addinappcuswid,.addinappEditwid", function () {

    if (fieldvalidation(selectedFieldType)) {

        var getmandatory = $("#ddlMandatory").val();
        var getscore = $("#txtScore").val();

        if (selectedFieldType == "Img") {
            $(
                ".inapptextcontwrp, .inappformwidwrp, .inappbantextwrp, .inappbantitlewrp, .inappinputwrp, .inappchckradiowrp, .inapprattingwrp, .inappbanbtnwrp"
            ).addClass("hideDiv");
            $(".inappbgbannerwrp, .inappactionwrp").removeClass("hideDiv");
        } else {
            $(".inappbantextwrp, .inappactionwrp").removeClass("hideDiv");
        }

        //selectedFieldId = inappfieldnum;

        var f_Value = selectedFieldType == "Tv" || selectedFieldType == "Btn" ? $("#inappaddtextcont").val() : selectedFieldType == "Et" || selectedFieldType == "Cb" || selectedFieldType == "Rg" || selectedFieldType == "Sp" ? $("#inappinptvalue").val() : "";

        $("#inapptextbgcol").val("");
        if (selectedFieldType == "Btn") {
            $("#inapptxtpaddtop,#inapptxtpaddbttm").val(10);
            $("#inapptextalign").val("Center");
            $("#inapptextcol").val("#ffffff");
            $("#inapptextbgcol").val("#5C225A");

            $("#inapptextcolsty").css("background-color", "rgb(255, 255, 255)");
            $("#inapptextbgcolsty").css("background-color", "rgb(92, 33, 90)");
        }
        else if (selectedFieldType == "Et" || selectedFieldType == "Sp") {
            $("#inapptxtpaddtop,#inapptxtpaddbttm,#inapptxtpaddright,#inapptxtpaddleft").val(5);
            $("#inapptextalign").val("Left");
            $("#inapptextcol").val("#495057");
            $("#inapptextbgcol").val("#ffffff");

            $("#inapptextcolsty").css("background-color", "rgb(73, 80, 87)");
            $("#inapptextbgcolsty").css("background-color", "rgb(255, 255, 255)");
        }

        if (selectedFieldId == -1) {
            selectedFieldId = finalField.length;
            updateFieldJson(-1, selectedFieldType, f_Value, getmandatory, getscore);
        } else {
            updateFieldJson(selectedFieldId, selectedFieldType, f_Value, getmandatory, getscore);
        }


        inappmousentleave();
        $(".inappparatext, .inappaddbtnswrp").removeClass("addoutline");
        $("#inappcustfield" + inappfieldnum).addClass("addoutline");
        $("#inappaddtextcont, #inappaddchckbxlist, #inappadddrpdwnlist").val("");
        $(".popupcontainer").addClass("hideDiv");
    }
});

/*Add content on Submit field*/


/*Text Style start here*/

var inapptxtszval;
//p5-change

$("#inapptextsize, #inapptextalign, #inapptextcol, #inapptextbold, #inapptextbgcol, #inapptextbrdcol, #inapptextbrdwid, #inapptextbrdradi, #inapptextmarg ,#inapptxtpaddtop,#inapptxtpaddright,#inapptxtpaddbttm,#inapptxtpaddleft,#txtFieldImage,#mobdefclickactbtn2,#ui_ddlScreen,#ui_ddlScreenIos,#txtDeeplink,#txtActionMsg,#txtBrowser,#inappclsedialogYes,#inappclsedialogNo,.txtparameter").change(function () {

    if ($("#txtFieldImage").val() != "") { fieldImage = $("#txtFieldImage").val(); }

    $(this).next().css("background-color", $(this).val());
    updateFieldJson(selectedFieldId, '', '', '', '');

    $(".inappparatext, .inappaddbtnswrp").removeClass("addoutline");
    $("#inappcustfield" + selectedFieldId).addClass("addoutline");

});

$("#inappmainbgcol, #inappmainbgbrdcol, #inappmainbgbrdwid, #inappmainbgbrdradi, #inappmainpos, #inappanimatban, #inappmaininterval, #inappmainclose, #inappbodypaddTop ,#inappbodypaddRight,#inappbodypaddbttm,#inappbodypaddLeft,#txtBgImage").change(function () {

    $(this).next().css("background-color", $(this).val());
    updateContainerJson();
});



/* Delete Settings*/ ////p5-delete

$(".inAppmaincontainer").on("click", ".insppeditdel .fa-trash", function () {

    selectedFieldId = parseInt($(this).parent().parent().attr("id").replace("inappcustfield", ""));
    $(
        ".inappbantextwrp, .inappbantitlewrp, .inappinputwrp, .inappbgbannerwrp, .inappchckradiowrp, .inapprattingwrp, .inappbanbtnwrp, .inappactionwrp"
    ).addClass("hideDiv");
    $(this).parent().parent().remove();
    DeleteWidget();
});

/* Delete Settings*/

//p5-properties
$(".inAppmaincontainer").on("click", ".insppeditdel .fa-pencil", function () {
    $(
        ".inappbantextwrp, .inappbantitlewrp, .inappbgbannerwrp, .inappinputwrp, .inappchckradiowrp, .inapprattingwrp, .inappbanbtnwrp, .inapptextcontwrp, .inappdrpdwnedit, .inappchckbxedit, .inappactionwrp"
    ).addClass("hideDiv");
    $(".popupcontainer").removeClass("hideDiv");
    $(".addinappcuswid").addClass("hideDiv");
    $(".addinappEditwid").removeClass("hideDiv");


    getinAppParentId = $(this).parent().parent().attr("id");
    selectedFieldId = parseInt(getinAppParentId.replace("inappcustfield", ""));


    BindFieldStyle();

    $(".inappparatext, .inappaddbtnswrp").removeClass("addoutline");
    $("#" + getinAppParentId).addClass("addoutline");

    selectedFieldType = $(this).parent().prev().attr("data-inputtype");

    //alert(selectedFieldType); //inapptitltext

    $("#inappaddfieldtype").val(selectedFieldType);

    if (selectedFieldType == "Img") {

        $(
            ".inapptextcontwrp, .inappformwidwrp, .inappbantextwrp, .inappbantitlewrp, .inappinputwrp, .inappchckradiowrp, .inapprattingwrp, .inappbanbtnwrp"
        ).addClass("hideDiv");
        $(".inappbgbannerwrp, .inappactionwrp").removeClass("hideDiv");
    }
    else if (selectedFieldType == "Et" || selectedFieldType == "Sp" || selectedFieldType == "Cb" || selectedFieldType == "Rg") {
        $(".inapptextcontwrp").addClass("hideDiv");
        $(".inappbantextwrp,.inappformwidwrp, .inappactionwrp, .inappinputwrp").removeClass(
            "hideDiv"
        );
    }
    else {
        $(".inappformwidwrp").addClass("hideDiv");
        $(".inappbantextwrp, .inapptextcontwrp, .inappactionwrp").removeClass(
            "hideDiv"
        );
    }

    $("#inappaddtextcont").val(finalField[selectedFieldId].Text);
    $("#inappinptlblname").val(finalField[selectedFieldId].Name);
    $("#inappinptvalue").val(finalField[selectedFieldId].Text);
    $("#ddlMandatory").val(finalField[selectedFieldId].Mandatory);
    $("#txtScore").val(finalField[selectedFieldId].Score);
    $("#ddlFieldCategory").val(finalField[selectedFieldId].Category);
    $("#ddlHorizontalAlign").val(finalField[selectedFieldId].Group);


});

//p5-style
$(".inAppmaincontainer").on(
    "click",
    ".insppeditdel .fa-paint-brush",
    function () {

        getinAppParentIdbrush = $(this).parent().parent().attr("id");
        selectedFieldId = parseInt(getinAppParentIdbrush.replace("inappcustfield", ""));
        //alert(selectedFieldId);

        BindFieldStyle();


        getInAppInputAttr = $(this).parent().prev().attr("data-inputtype");
        getInAppPrevclsscss = $(this).parent().prev().attr("class");
        $(".inappparatext, .inappaddbtnswrp").removeClass("addoutline");
        $("#" + getinAppParentIdbrush).addClass("addoutline");
        $(
            ".inappbantextwrp, .inappbantitlewrp, .inappinputwrp, .inappchckradiowrp, .inapprattingwrp, .inappbanbtnwrp, .inappbgbannerwrp, .inappactionwrp"
        ).addClass("hideDiv");

        //alert(getInAppInputAttr);
        if (getInAppInputAttr == "Img") {
            $(
                ".inapptextcontwrp, .inappformwidwrp, .inappbantextwrp, .inappbantitlewrp, .inappinputwrp, .inappchckradiowrp, .inapprattingwrp, .inappbanbtnwrp"
            ).addClass("hideDiv");
            $(".inappbgbannerwrp, .inappactionwrp").removeClass("hideDiv");
        } else {
            $(".inappbantextwrp, .inappactionwrp").removeClass("hideDiv");
        }

    }
);


$("#close-popup, .clsepopup").click(function () {
    $(this).parents(".popupcontainer").addClass("hideDiv");
    $("tr").removeClass("activeBgRow");
});


function CreateNext(divid) {
    $(".campaingmaincontainer").addClass("hideDiv");
    $("#dvCreateCampaign" + divid).removeClass("hideDiv");
}

function DeleteWidget() {

    var getId = selectedFieldId;
    var fil = [];
    for (var a = 0; a < finalField.length; a++) {
        if (a != getId)
            fil.push(finalField[a]);
    }
    finalField = fil;

    BindPreView();
}

function updateContainerJson() {
    var getpadding = '' + $("#inappbodypaddLeft").val() + ',' + $("#inappbodypaddTop").val() + ',' + $("#inappbodypaddRight").val() + ',' + $("#inappbodypaddbttm").val() + '';

    var f_Json = {
        "Animation": "" + $("#inappanimatban").val() + "",
        "BgColor": "" + $("#inappmainbgcol").val() + "",
        "BgImage": "" + bgImage + "",
        "Border": "" + $("#inappmainbgbrdcol").val() + "",
        "BorderRadius": "" + $("#inappmainbgbrdradi").val() + "",
        "BorderWidth": "" + $("#inappmainbgbrdwid").val() + "",
        "Close": "" + $("#inappmainclose").val() + "",
        "Height": "1",
        "Interval": "" + $("#inappmaininterval").val() + "",
        "Padding": "" + getpadding + "",
        "Position": "" + $("#inappmainpos").val() + "",
        "ScreenName": ""

    };

    container = f_Json;
    BindPreView();
}

function updateFieldJson(getfieldid, type, fValue, mandatory, score) {

    var fieldid = getfieldid;
    var getmargin = '' + $("#inapptextmarg").val() + ',' + $("#inapptextmarg").val() + ',' + $("#inapptextmarg").val() + ',' + $("#inapptextmarg").val() + '';
    var getpadding = '' + $("#inapptxtpaddleft").val() + ',' + $("#inapptxtpaddtop").val() + ',' + $("#inapptxtpaddright").val() + ',' + $("#inapptxtpaddbttm").val() + '';

    if (fieldid != -1 && fValue == "") {
        type = finalField[fieldid].Type;
        fValue = finalField[fieldid].Text;
        mandatory = finalField[fieldid].Mandatory;
        score = finalField[fieldid].Score;
    }

    var redirect = $("#mobdefclickactbtn2").val() == "0" ? "" : $("#mobdefclickactbtn2").val() == "Screen" ? $("#ui_ddlScreen").val() : $("#mobdefclickactbtn2").val() == "Deeplink" ? $("#txtDeeplink").val() : $("#mobdefclickactbtn2").val() == "Browser" ? $("#txtBrowser").val() : "";
    var iosredirect = $("#mobdefclickactbtn2").val() == "Screen" ? $("#ui_ddlScreenIos").val() : redirect;
    var fCategory = $("#ddlFieldCategory").val() == 'EmailId' ? "Emailid" : $("#ddlFieldCategory").val() == 'PhoneNumber' ? "Phone" : $("#ddlFieldCategory").val();

    var f_Json = {
        "Type": "" + type + "",
        "Text": "" + fValue + "",
        "ImageUrl": "" + fieldImage + "",
        "Name": "" + $("#inappinptlblname").val() + "",
        "Category": "" + fCategory + "",
        "Score": "" + score + "",
        "Size": "" + $("#inapptextsize").val() + "",
        "Color": "" + $("#inapptextcol").val() + "",
        "BgColor": "" + $("#inapptextbgcol").val() + "",
        "Style": "" + $("#inapptextbold").val() + "",
        "Border": "" + $("#inapptextbrdcol").val() + "",
        "BorderWidth": "" + $("#inapptextbrdwid").val() + "",
        "BorderRadius": "" + $("#inapptextbrdradi").val() + "",
        "Mandatory": "" + mandatory + "",
        "Width": "100",
        "Margin": "" + getmargin + "",
        "Padding": "" + getpadding + "",
        "Align": "",
        "Orientation": "" + $("#inapptextalign").val() + "",
        "Group": "1",
        "Action": "" + $("#mobdefclickactbtn2").val() + "",
        "Message": "" + $("#txtActionMsg").val() + "",
        "Redirect": "" + redirect + "",
        "IosRedirect": "" + iosredirect + "",
        "Parameter": "" + getKeyPairValue('') + "",
        "CloseDialog": "" + document.querySelector('input[name="inappclsedialtype"]:checked').value + ""
    };

    if (fieldid != -1) {
        finalField[fieldid] = f_Json;
    }
    else {
        finalField.push(f_Json);
    }
    inappfieldnum = finalField.length;

    BindPreView();
}

function SaveImage(fileid) {
    ShowPageLoading();
    if ($("#" + fileid).val() != "") {
        var uploadFile = $("#" + fileid).get(0);
        var uploadedfile = uploadFile.files;
        var fromdata;
        if (typeof window.FormData == "undefined")
            fromdata = [];
        else
            fromdata = new window.FormData();
        for (var i = 0; i < uploadedfile.length; i++) {
            if (typeof window.FormData == "undefined")
                fromdata.push(uploadedfile[i].name, uploadedfile[i]);
            else
                fromdata.append(uploadedfile[i].name, uploadedfile[i]);
        }


        var choice = {};
        choice.url = "/CreateCampaign/SaveImage",
            choice.type = "POST";
        choice.data = fromdata;
        choice.contentType = false;
        choice.processData = false;
        choice.async = false;
        choice.success = function (response) {
            var status = response;
            if (response == 0) {
                ShowErrorMessage(GlobalErrorList.WebpushTemplate.FileFormat);
            }
            else {
                if (uploadFile["id"] == "inapptopbanuplfile") {
                    var fieldNo = selectedFieldId;
                    fieldImage = response;
                    $("#inappcustfield" + fieldNo + " div").css("background-image", "url(" + response + ")");
                    updateFieldJson(selectedFieldId, 'Img', '', '', '');
                }
                else if (uploadFile["id"] == "inappfileuploadbtn") {
                    bgImage = response;
                    $(".inAppmaincontainer").css("background-image", "url(" + response + ")");
                    updateContainerJson();
                }
            }
            HidePageLoading();

            $(".chosefile").val('');
        };
        choice.error = function (result) {
            ShowErrorMessage(GlobalErrorList.WebpushTemplate.FileFormat);
        };
        $.ajax(choice);
        event.preventDefault();
    }
}


function GetScreenList() {
    $.ajax({
        type: "POST",
        url: "/MobilePushNotification/DesignMobilePushTemplate/GetScreenList",
        data: "{'accountId':'" + Plumb5AccountId + "'}",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (response) {
            $.each(response.Table, function () {
                $("#ui_ddlScreen").append('<option value="' + $(this)[0].ScreenName + '">' + $(this)[0].ScreenName + '</option>');

                $("#ui_ddlScreenIos").append('<option value="' + $(this)[0].ScreenName + '">' + $(this)[0].ScreenName + '</option>');
            });


        },
        error: ShowAjaxError
    });

}






//////////////////


$(".inappstarratitemwrp span").click(function () {
    $(this).prevAll().removeClass("fa-star-o").addClass("fa-star");
    $(this).removeClass("fa-star-o").addClass("fa-star");
});

inappraticlick = () => {
    $(".inappstarratitemwrp span").click(function () {
        $(this).prevAll().removeClass("fa-star-o").addClass("fa-star");
        $(this).removeClass("fa-star-o").addClass("fa-star");
    });
};

$(".inappviewtemp").click(function () {
    $("#inappviewtempmod").modal("show");
});

$('input[name="inappbgoptiontype"]').click(function () {
    let getinappbgoptval = $('input[name="inappbgoptiontype"]:checked').val();
    if (getinappbgoptval == "onlineurl") {
    }
});


$(".inappclsefile").click(function () {
    $(this).parent().addClass("hideDiv");
});

$('input[name="inappbgoptiontype"]').click(function () {
    let getinappbgupldoptval = $('input[name="inappbgoptiontype"]:checked').val();
    if (getinappbgupldoptval == "onlineurl") {
        $(".inappbguploadfile").addClass("hideDiv");
        $(".inappbgonlineurlwrp").removeClass("hideDiv");
    } else {
        $(".inappbgonlineurlwrp").addClass("hideDiv");
        $(".inappbguploadfile").removeClass("hideDiv");
    }
});



$("#inappbgcol").change(function () {
    let getinappbgcolval = $(this).val();
    $(".inappbgcolicon").css("background-color", getinappbgcolval);
});

$("#inappbgbrdcol").change(function () {
    let getinappbgbrdcolval = $(this).val();
    $(".inappbgbrdcolicon").css("background-color", getinappbgbrdcolval);
});

$('input[name="inapptopbantype"]').click(function () {
    let getinapptpbanval = $('input[name="inapptopbantype"]:checked').val();
    if (getinapptpbanval == "onlineurl") {
        $("#inapptopbanupld").addClass("hideDiv");
        $("#inapptopbanonline").removeClass("hideDiv");
    } else {
        $("#inapptopbanonline").addClass("hideDiv");
        $("#inapptopbanupld").removeClass("hideDiv");
    }
});


$('input[name="inapptextpaddingtype"]').click(function () {
    let getinapptxtpadtypeval = $(
        'input[name="inapptextpaddingtype"]:checked'
    ).val();
    if (getinapptxtpadtypeval == "indivside") {
        $(this).parent().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
        $("#inapptextpaddall").val("");
        inappStyleEditCss.inapptxtpadallval = "";
        addp5InAppStyleCss(inappStyleEditCss);
    } else {
        $(this).parent().next().next().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
        $(
            "#inapptxtpaddtop, #inapptxtpaddright, #inapptxtpaddbttm, #inapptxtpaddleft"
        ).val("");
        inappStyleEditCss.inapptxtpaddtopval = "";
        inappStyleEditCss.inapptxtpaddrightval = "";
        inappStyleEditCss.inapptxtpaddbttmval = "";
        inappStyleEditCss.inapptxtpaddlftval = "";
        addp5InAppStyleCss(inappStyleEditCss);
    }
});

$("#inappfullscreenimg").change(function (u) {
    let inappfilename = u.target.files[0].name;
    $(this).parent().next().removeClass("hideDiv");
    $(".inappfulscrnflename").html(inappfilename);
});

$('input[name="inappfullscreenimgtype"]').click(function () {
    let inappfulscrenimgtype = $(
        'input[name="inappfullscreenimgtype"]:checked'
    ).val();
    if (inappfulscrenimgtype == "onlineurl") {
        $(this).parent().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
    } else {
        $(this).parent().next().next().removeClass("hideDiv");
        $(this).parent().next().next().next().addClass("hideDiv");
    }
});

$('input[name="inapptitlepaddtype"]').click(function () {
    let getinapptitpadtypeval = $(
        'input[name="inapptitlepaddtype"]:checked'
    ).val();
    if (getinapptitpadtypeval == "indivside") {
        $(this).parent().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
    } else {
        $(this).parent().next().next().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
    }
});

$("#inapptitlebanuplfile").change(function (r) {
    let inappfilename = r.target.files[0].name;
    $(this).parent().next().removeClass("hideDiv");
    $(".inappmidbanfilename").html(inappfilename);
});

$('input[name="inappmiddlebantype"]').click(function () {
    let inapptitleimgtype = $('input[name="inappmiddlebantype"]:checked').val();
    if (inapptitleimgtype == "onlineurl") {
        $(this).parent().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
    } else {
        $(this).parent().next().next().removeClass("hideDiv");
        $(this).parent().next().next().next().addClass("hideDiv");
    }
});

$(".inapptitbtnwrp").click(function () {
    let getinappbtntabval = $(this).attr("data-btntab");
    $(".inapptitbtnwrp").removeClass("active");
    $(this).addClass("active");
    $(".inAppbtncontwrp").addClass("hideDiv").fadeIn();
    $("#" + getinappbtntabval).removeClass("hideDiv");
});

$('input[name="inappfulscrnbantype"]').click(function () {
    let inappfulscrntxtimgtype = $(
        'input[name="inappfulscrnbantype"]:checked'
    ).val();
    if (inappfulscrntxtimgtype == "onlineurl") {
        $(this).parent().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
    } else {
        $(this).parent().next().next().removeClass("hideDiv");
        $(this).parent().next().next().next().addClass("hideDiv");
    }
});

$("#inappfulscrnbanuplfile").change(function (t) {
    let inappfilename = t.target.files[0].name;
    $(this).parent().next().removeClass("hideDiv");
    $(".inappfulscrnbanfilename").html(inappfilename);
});

$('input[name="inappfulscrntxtpaddtype"]').click(function () {
    let getinappfulscrntxtpadtypeval = $(
        'input[name="inappfulscrntxtpaddtype"]:checked'
    ).val();
    if (getinappfulscrntxtpadtypeval == "indivside") {
        $(this).parent().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
    } else {
        $(this).parent().next().next().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
    }
});

$('input[name="inappratingpaddtype"]').click(function () {
    let getinappratitlepadtypeval = $(
        'input[name="inappratingpaddtype"]:checked'
    ).val();
    if (getinappratitlepadtypeval == "indivside") {
        $(this).parent().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
    } else {
        $(this).parent().next().next().next().addClass("hideDiv");
        $(this).parent().next().next().removeClass("hideDiv");
    }
});

$("#inappmainbgcol").change(function () {
    inappStyleEditCss.inappmainbgcolval = $(this).val();
    $(this).next().css("background-color", inappStyleEditCss.inappmainbgcolval);
    addp5InAppStyleCss(inappStyleEditCss);
});

$("#inappmainbgbrdcol").change(function () {
    inappStyleEditCss.inappmainbgbrdcol = $(this).val();
    $(this).next().css("background-color", inappStyleEditCss.inappmainbgbrdcol);
    addp5InAppStyleCss(inappStyleEditCss);
});

$("#inappmainbgbrdwid").change(function () {
    inappStyleEditCss.inappmainbgbrdwid = $(
        "#inappmainbgbrdwid option:selected"
    ).val();
    addp5InAppStyleCss(inappStyleEditCss);
});

$("#inappmainbgbrdradi").change(function () {
    inappStyleEditCss.inappmainbgbrdradival = $(
        "#inappmainbgbrdradi option:selected"
    ).val();
    addp5InAppStyleCss(inappStyleEditCss);
});

$("#inappbodypaddAll").change(function () {
    inappStyleEditCss.inappmainbgpadAll = $(this).val();
    addp5InAppStyleCss(inappStyleEditCss);
});

$("#inappbodypaddTop").change(function () {
    inappStyleEditCss.inappmainbgpadTop = $(this).val();
    addp5InAppStyleCss(inappStyleEditCss);
});

$("#inappbodypaddRight").change(function () {
    inappStyleEditCss.inappmainbgpadright = $(this).val();
    addp5InAppStyleCss(inappStyleEditCss);
});

$("#inappbodypaddbttm").change(function () {
    inappStyleEditCss.inappmainbgpadbtm = $(this).val();
    addp5InAppStyleCss(inappStyleEditCss);
});

$("#inappbodypaddLeft").change(function () {
    inappStyleEditCss.inappmainbgpadlft = $(this).val();
    addp5InAppStyleCss(inappStyleEditCss);
});

$("#inappmainpos").change(function () {
    let inappmainposva = $("#inappmainpos option:selected").val();
    $(".pushnotifprevrite .chatmobdevbody").removeClass(
        "df-ac-top df-ac-center df-ac-bottom"
    );
    if (inappmainposva == "Top") {
        $(".pushnotifprevrite .chatmobdevbody").addClass("df-ac-top");
    } else if (inappmainposva == "Center") {
        $(".pushnotifprevrite .chatmobdevbody").addClass("df-ac-center");
    } else {
        $(".pushnotifprevrite .chatmobdevbody").addClass("df-ac-bottom");
    }
});

$("#inappanimatban").change(function () {
    let inappanimatval = $("#inappanimatban option:selected").attr(
        "data-animateban"
    );
    $(".inAppmaincontainer")
        .removeClass("animate__slideInUp")
        .removeClass("animate__slideInDown")
        .removeClass("animate__slideInLeft")
        .removeClass("animate__slideInRight");
    $(".inAppmaincontainer").addClass(inappanimatval);
});

$(".inapptabitemwrp").click(function () {
    let gettabcontname = $(this).attr("title");
    $(".inapptabitemwrp").removeClass("active");
    $(".inappcontentwrp").addClass("hideDiv");
    $(this).addClass("active");
    $("#" + gettabcontname).removeClass("hideDiv");
});

$("#mobdefclickactbtn2").change(function () {
    let getmobdefbtn2val = $("#mobdefclickactbtn2 option:selected").val();
    //alert(getmobdefbtn2val);
    if (getmobdefbtn2val == "Deeplink") {
        $(".naviscreenbtn2,.naviscreenbtn2ios, .brwserurlbtn2").addClass("hideDiv");
        $(".deeplinkingfildbtn2, .mobnotifvalpairbtn2").removeClass("hideDiv");
    } else if (getmobdefbtn2val == "Browser") {
        $(".naviscreenbtn2,.naviscreenbtn2ios, .deeplinkingfildbtn2, .mobnotifvalpairbtn2").addClass(
            "hideDiv"
        );
        $(".brwserurlbtn2").removeClass("hideDiv");
    } else if (getmobdefbtn2val == "Cancel" || getmobdefbtn2val == "0") {
        $(
            ".naviscreenbtn2,.naviscreenbtn2ios, .deeplinkingfildbtn2, .mobnotifvalpairbtn2, .brwserurlbtn2"
        ).addClass("hideDiv");
    } else {
        $(".deeplinkingfildbtn2, .brwserurlbtn2").addClass("hideDiv");
        $(".naviscreenbtn2,.naviscreenbtn2ios, .mobnotifvalpairbtn2").removeClass("hideDiv");
    }
});

$(".addmobvalpairbtn2").click(function () {
    let addmobkeyvalbtn2 = `<div class="mobvalpairitem">
  <input type="text" class="form-control txtparameter" name=""
      placeholder="Name" id="">
  <input type="text"
      class ="form-control mr-2 border-left-0 txtparameter"
      placeholder="Data" name="" id="">
  <button type="button"
      class="btn btn-outline-danger btn-sm delmobvalpair"><i
          class="fa fa-trash"></i></button>
</div>`;
    $(".mobvalpairmorebtn2").append(addmobkeyvalbtn2);


    $(".txtparameter").change(function () {
        updateFieldJson(selectedFieldId, '', '', '', '');

    });

});


$(".mobnotifvalpair, .mobnotifvalpairbtn1, .mobnotifvalpairbtn2").on(
    "click",
    ".delmobvalpair",
    function () {
        updateFieldJson(selectedFieldId, '', '', '', '');
        $(this).parent().remove();
    }
);
function setKeyPairValue(selItem, KeyPairValue) {
    if (KeyPairValue != null && KeyPairValue != '' && KeyPairValue != undefined) {
        var splitVal = KeyPairValue.split(',');
        for (var k = 0; k < splitVal.length; k++) {
            var data = splitVal[k].split('=');
            if (k == 0) {
                $(".KeyPairValue" + selItem + " :input[type='text']").each(function (index) {
                    $(this).val(data[index]);
                });
            }
            else {
                selItem = selItem.length > 0 ? 'btn' + selItem : selItem;
                $(".addmobvalpairbtn2" + selItem).click();
                $(".mobvalpairmorebtn2" + selItem + " .mobvalpairitem:last-child :input[type='text']").each(function (index) {
                    $(this).val(data[index]);
                });
            }
        }
    }
}

function getKeyPairValue(selItem) {

    var key = ''; var ClickKeyPairValue = '';

    $(".KeyPairValue" + selItem + " :input[type='text']").each(function () {
        if (key.length > 0) {
            ClickKeyPairValue = key + "=" + $(this).val();
            key = '';
        } else {
            key = $(this).val();
        }

    });

    selItem = selItem.length > 0 ? 'btn' + selItem : selItem;
    $(".mobvalpairmorebtn2" + selItem + " :input[type='text']").each(function () {

        if (key.length > 0) {
            if (ClickKeyPairValue.length > 0)
                ClickKeyPairValue = ClickKeyPairValue + "," + key + "=" + $(this).val();
            else
                ClickKeyPairValue = key + "=" + $(this).val();

            key = '';
        } else {
            key = $(this).val();
        }

    });

    return ClickKeyPairValue;
}

function fieldvalidation(type) {
    if ($("#inappinptlblname").val() == "" && (type == "Et" || type == "Sp" || type == "Rg" || type == "Cb")) {
        ShowErrorMessage(GlobalErrorList.ManageInappCampaign.FieldName);
        return false;
    }
    if ($("#inappinptvalue").val() == "" && (type == "Et" || type == "Sp" || type == "Rg" || type == "Cb")) {
        ShowErrorMessage(GlobalErrorList.ManageInappCampaign.FieldValue);
        return false;
    }
    if ($("#inappaddtextcont").val() == "" && (type == "Tv" || type == "Btn")) {
        ShowErrorMessage(GlobalErrorList.ManageInappCampaign.FieldValue);
        return false;
    }
    if ($("#ddlFieldCategory").val() == "None" && (type == "Et" || type == "Sp" || type == "Rg" || type == "Cb")) {
        ShowErrorMessage(GlobalErrorList.ManageInappCampaign.FieldMapping);
        return false;
    }
    return true;
}



function fieldValidation() {

    for (var fieldNo = 0; fieldNo < finalField.length; fieldNo++) {

        if (finalField[fieldNo].Action == 'Screen' && finalField[fieldNo].Redirect == 'select') {
            ShowErrorMessage(GlobalErrorList.ManageInappCampaign.NavigateScreen);
            return false;
        }
        if (finalField[fieldNo].Action == 'Screen' && finalField[fieldNo].Redirect == 'select') {
            ShowErrorMessage(GlobalErrorList.ManageInappCampaign.IosNavigateScreen);
            return false;
        }

        if (finalField[fieldNo].Action == 'Deeplink' && $.trim(finalField[fieldNo].Redirect).length == 0) {
            ShowErrorMessage(GlobalErrorList.ManageInappCampaign.Deeplinking);
            return false;
        }

        if (finalField[fieldNo].Action == 'Browser' && $.trim(finalField[fieldNo].Redirect).length == 0) {
            ShowErrorMessage(GlobalErrorList.ManageInappCampaign.Browserurl);
            return false;
        }
        if (finalField[fieldNo].Action == 'Browser' && urlregex.test(finalField[fieldNo].Redirect) == false) {
            ShowErrorMessage(GlobalErrorList.ManageInappCampaign.BrowserurlValidUrl);
            return false;
        }
    }
    return true;
}

function GetContactProperties(Id) {
    $.ajax({
        url: "/ManageContact/ContactImport/GetContactProperties",
        type: 'POST',
        data: JSON.stringify({ 'accountId': Plumb5AccountId }),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        async: false,
        success: function (response) {
            if (response != undefined && response != null && response.length > 0) {

                for (var i = 0; i < response.length; i++) {
                    // $("#" + Id).append("<option value='" + response[i].FieldName + "'>" + response[i].FieldName + "</option>");
                    ContactPropertyList.push({
                        'P5ColumnName': response[i].FieldName, 'FrontEndName': response[i].FieldName, 'FieldType': response[i].FieldName
                    });
                }
                if (ContactPropertyList != null && ContactPropertyList.length > 0) {
                    //To sort dropdown by alphabetical order **************
                    let field = 'FrontEndName';
                    ContactPropertyList.sort((a, b) => (a[field] || "").toString().localeCompare((b[field] || "").toString()));
                    //****************************************
                    for (var i = 0; i < ContactPropertyList.length; i++) {
                        $("#" + Id).append("<option value='" + ContactPropertyList[i].P5ColumnName + "'>" + ContactPropertyList[i].FrontEndName + "</option>");
                    }
                }
            }
            HidePageLoading();
        },
        error: ShowAjaxError
    });
}

function getFormFields() {

    var CaptureFormFields = [];
    for (var fieldNo = 0; fieldNo < finalField.length; fieldNo++) {
        var type = finalField[fieldNo].Type;
        if (type == "Et" || type == "Sp" || type == "Rg" || type == "Cb") {
            var fCategory = finalField[fieldNo].Category == 'Emailid' ? "EmailId" : $("#ddlFieldCategory").val() == 'Phone' ? "PhoneNumber" : finalField[fieldNo].Category;

            CaptureFormFields.push([finalField[fieldNo].Name, fCategory]);
        }
    }
    return CaptureFormFields;
}

function getInAppDesign() {
    getFinalJson = { "Display": container, "Fields": finalField };
    return JSON.stringify(getFinalJson);
}